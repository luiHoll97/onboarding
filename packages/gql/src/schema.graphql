# Proto-first: mirrors driver.v1. Resolvers receive proto-shaped parents and map to GQL.
enum DriverStatus {
  PENDING
  APPROVED
  REJECTED
}

enum AdminRole {
  SUPER_ADMIN
  OPERATIONS
  RECRUITER
  VIEWER
}

enum AdminPermission {
  MANAGE_ADMINS
  VIEW_DRIVERS
  EDIT_DRIVERS
  VIEW_STATS
  SEND_FORMS
}

type AdminUser {
  id: ID!
  email: String!
  name: String!
  role: AdminRole!
  permissions: [AdminPermission!]!
  createdAt: String!
}

type AuthSession {
  token: String!
  expiresAt: String!
  user: AdminUser!
}

type SentFormInvitation {
  sent: Boolean!
  prefilledUrl: String!
  qrCodeUrl: String!
  messageId: String!
  provider: String!
}

type WebhookEvent {
  id: ID!
  provider: String!
  eventName: String!
  externalEventId: String!
  status: String!
  attempts: Int!
  createdAt: String!
  processedAt: String!
  errorMessage: String!
}

enum AuditAction {
  CREATED
  UPDATED
  STATUS_CHANGED
}

type AuditEvent {
  id: ID!
  actor: String!
  action: AuditAction!
  timestamp: String!
  field: String!
  oldValue: String!
  newValue: String!
  note: String!
}

type Driver {
  id: ID!
  name: String!
  firstName: String!
  lastName: String!
  email: String!
  phone: String
  status: DriverStatus!
  appliedAt: String
  dateOfBirth: String
  nationalInsuranceNumber: String
  rightToWorkCheckCode: String
  inductionDate: String
  interviewDate: String
  idDocumentType: String
  idDocumentNumber: String
  idCheckCompleted: Boolean!
  idCheckCompletedAt: String
  driversLicenseNumber: String
  driversLicenseExpiryDate: String
  addressLine1: String
  addressLine2: String
  city: String
  postcode: String
  emergencyContactName: String
  emergencyContactPhone: String
  emergencyContactRelationship: String
  vehicleType: String
  preferredDaysPerWeek: String
  preferredStartDate: String
  detailsConfirmedByDriver: String
  notes: String
  auditTrail: [AuditEvent!]!
}

input DriverFiltersInput {
  status: DriverStatus
  search: String
}

input StatsFiltersInput {
  status: DriverStatus
  search: String
}

input UpdateDriverInput {
  id: ID!
  name: String!
  firstName: String!
  lastName: String!
  email: String!
  phone: String
  status: DriverStatus!
  appliedAt: String
  dateOfBirth: String
  nationalInsuranceNumber: String
  rightToWorkCheckCode: String
  inductionDate: String
  interviewDate: String
  idDocumentType: String
  idDocumentNumber: String
  idCheckCompleted: Boolean!
  idCheckCompletedAt: String
  driversLicenseNumber: String
  driversLicenseExpiryDate: String
  addressLine1: String
  addressLine2: String
  city: String
  postcode: String
  emergencyContactName: String
  emergencyContactPhone: String
  emergencyContactRelationship: String
  vehicleType: String
  preferredDaysPerWeek: String
  preferredStartDate: String
  detailsConfirmedByDriver: String
  notes: String
}

type Query {
  me: AdminUser
  webhooks(provider: String, limit: Int): [WebhookEvent!]!
  admins: [AdminUser!]!
  admin(id: ID!): AdminUser
  driver(id: ID!): Driver
  drivers(pageSize: Int, pageToken: String): DriversConnection!
  driversByFilters(
    filters: DriverFiltersInput
    pageSize: Int
    pageToken: String
  ): DriversConnection!
  stats(filters: StatsFiltersInput): DriverStats!
}

type Mutation {
  login(email: String!, password: String!): AuthSession
  logout: Boolean!
  createAdmin(input: CreateAdminInput!): AdminUser
  updateAdminAccess(input: UpdateAdminAccessInput!): AdminUser
  deleteAdmin(id: ID!): Boolean!
  updateDriver(input: UpdateDriverInput!, actor: String): Driver
  sendAdditionalDetailsForm(driverId: ID!, mondayId: String): SentFormInvitation!
}

input CreateAdminInput {
  email: String!
  name: String!
  password: String!
  role: AdminRole!
  permissions: [AdminPermission!]
}

input UpdateAdminAccessInput {
  id: ID!
  role: AdminRole!
  permissions: [AdminPermission!]
}

type DriversConnection {
  drivers: [Driver!]!
  nextPageToken: String
}

type DriverStatusCount {
  status: DriverStatus!
  count: Int!
}

type DriverStats {
  byStatus: [DriverStatusCount!]!
  total: Int!
}
